<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Night City Roulette</title>

<style>
body{
margin:0;
font-family:Courier New;
background:linear-gradient(180deg,#050010,#0a001a);
color:#fff;
overflow:hidden;
}

.glitch{
font-size:40px;
color:#fff;
text-shadow:
2px 2px #ff00ff,
-2px -2px #00ffff;
animation:gl 2s infinite alternate;
}
@keyframes gl{
0%{text-shadow:2px 2px #ff00ff,-2px -2px #00ffff;}
100%{text-shadow:-2px 2px #00ffff,2px -2px #ff00ff;}
}

button,input{
padding:10px 20px;
margin:5px;
background:black;
color:#00ffff;
border:2px solid #00ffff;
cursor:pointer;
font-size:16px;
}

button:hover{
background:#00ffff;
color:black;
}

.hidden{display:none;}

#lobbyPlayers{
position:absolute;
right:20px;
top:100px;
width:220px;
border-left:2px solid #00ffff;
padding-left:15px;
}

#gameArea{
position:relative;
width:600px;
height:600px;
margin:20px auto;
}

#circle{
position:absolute;
inset:0;
border-radius:50%;
border:2px solid #00ffff;
}

.playerLabel{
position:absolute;
transform:translate(-50%,-50%);
transition:0.5s;
}

.dead{
opacity:0.3;
text-decoration:line-through;
}

#arrow{
position:absolute;
width:0;
height:0;
border-left:15px solid transparent;
border-right:15px solid transparent;
border-bottom:30px solid yellow;
top:-15px;
left:50%;
transform-origin:center bottom;
transition:0.5s;
}
</style>
</head>

<body>

<div id="startScreen" style="text-align:center;margin-top:150px;">
<h1 class="glitch">NIGHT CITY ROULETTE</h1>
<input id="nameInput" placeholder="Your name"><br>
<button id="enterBtn">ENTER</button>
</div>

<div id="menuScreen" class="hidden" style="text-align:center;">
<h2>Lobby Menu</h2>
<input id="lobbyCodeInput" placeholder="Private Code">
<button id="createPublicBtn">Create Public</button>
<button id="createPrivateBtn">Create Private</button>
<button id="joinBtn">Join</button>
</div>

<div id="lobbyScreen" class="hidden">
<h2 id="lobbyTitle"></h2>
<button id="addAiBtn">Add AI</button>
<button id="startGameBtn">Start Game</button>
<button id="leaveBtn">Leave</button>

<div id="lobbyPlayers"></div>

<div>
<div id="chatMessages" style="height:120px;overflow-y:auto;border:1px solid #00ffff;"></div>
<input id="chatInput" placeholder="message">
<button id="sendChatBtn">Send</button>
</div>
</div>

<div id="gameScreen" class="hidden">
<h2 id="status"></h2>

<div id="gameArea">
<div id="circle"></div>
<div id="arrow"></div>
</div>

<button id="spinBtn">Spin</button>
<button id="shootBtn">Shoot x1</button>
<button id="doubleBtn">Shoot x2</button>
<button id="giveUpBtn">Give Up</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig={
apiKey:"AIzaSyBa5w0hQ1v7Nowk-BvDgkGeNRNf1WJtDgw",
authDomain:"rrweb-dc73f.firebaseapp.com",
databaseURL:"https://rrweb-dc73f-default-rtdb.europe-west1.firebasedatabase.app",
projectId:"rrweb-dc73f"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

let currentLobby=null;
let playerName="";
let isHost=false;

const screens={
start:document.getElementById("startScreen"),
menu:document.getElementById("menuScreen"),
lobby:document.getElementById("lobbyScreen"),
game:document.getElementById("gameScreen")
};

function show(s){
Object.values(screens).forEach(x=>x.classList.add("hidden"));
s.classList.remove("hidden");
}

document.getElementById("enterBtn").onclick=()=>{
playerName=document.getElementById("nameInput").value||"Player";
show(screens.menu);
};

function randomCode(){
return Math.random().toString(36).substring(2,7).toUpperCase();
}

document.getElementById("createPublicBtn").onclick=()=>{
createLobby(null);
};

document.getElementById("createPrivateBtn").onclick=()=>{
const code=document.getElementById("lobbyCodeInput").value.trim();
if(!code){alert("Code missing");return;}
createLobby(code);
};

function createLobby(code){
let lobbyId=randomCode();
currentLobby=lobbyId;
isHost=true;

set(ref(db,"lobbies/"+lobbyId),{
host:playerName,
private:code?true:false,
code:code||null,
players:{
[playerName]:{alive:true,isAI:false}
},
game:{state:"lobby"}
});
listenLobby();
show(screens.lobby);
document.getElementById("lobbyTitle").innerText="Lobby Code: "+lobbyId+(code?" | Private Code: "+code:"");
}

document.getElementById("joinBtn").onclick=()=>{
let code=document.getElementById("lobbyCodeInput").value.trim().toUpperCase();
if(!code)return alert("Enter lobby code");

currentLobby=code;
isHost=false;

update(ref(db,"lobbies/"+code+"/players"),{
[playerName]:{alive:true,isAI:false}
});
listenLobby();
show(screens.lobby);
};

function listenLobby(){
onValue(ref(db,"lobbies/"+currentLobby),(snap)=>{
if(!snap.exists()){ show(screens.menu); return; }
let data=snap.val();
renderPlayers(data.players);
});
}

function renderPlayers(players){
let div=document.getElementById("lobbyPlayers");
div.innerHTML="<h3>Players</h3>";
for(let p in players){
div.innerHTML+="<div>"+p+(players[p].isAI?" (AI)":"")+"</div>";
}
}

document.getElementById("addAiBtn").onclick=()=>{
update(ref(db,"lobbies/"+currentLobby+"/players"),{
["AI-"+Math.floor(Math.random()*999)]:{alive:true,isAI:true}
});
};

document.getElementById("leaveBtn").onclick=async()=>{
let pRef=ref(db,"lobbies/"+currentLobby+"/players/"+playerName);
await remove(pRef);

onValue(ref(db,"lobbies/"+currentLobby+"/players"),(snap)=>{
if(!snap.exists()){
remove(ref(db,"lobbies/"+currentLobby));
}
});

show(screens.menu);
};

document.getElementById("startGameBtn").onclick=()=>{
update(ref(db,"lobbies/"+currentLobby+"/game"),{
state:"playing",
bullet:Math.floor(Math.random()*6),
pos:0,
turn:playerName
});
show(screens.game);
};

</script>

</body>
</html>
