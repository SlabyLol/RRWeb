<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RUSSIAN ROULETTE Ã— NIGHT CITY</title>

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>

<style>
:root{
--pink:#ff0044;
--cyan:#00ffff;
--purple:#c300ff;
--bg:#0a0015;
}
body{
margin:0;
background:var(--bg);
color:white;
font-family:Courier New,monospace;
overflow:hidden;
}
.screen{
position:absolute;
inset:0;
display:none;
flex-direction:column;
align-items:center;
justify-content:center;
}
.active{display:flex;}

.title{
font-size:6vw;
letter-spacing:8px;
text-shadow:0 0 20px var(--cyan),0 0 50px var(--pink);
animation:glitch 3s infinite;
}
@keyframes glitch{
0%{transform:translate(0)}
10%{transform:translate(3px,-3px)}
20%{transform:translate(-3px,3px)}
30%{transform:translate(0)}
}

button{
padding:15px 40px;
margin:15px;
font-size:1.2rem;
background:transparent;
color:var(--pink);
border:2px solid var(--pink);
cursor:pointer;
transition:0.2s;
}
button:hover{
background:var(--pink);
color:black;
}

.player-card{
border:2px solid var(--purple);
padding:10px 25px;
margin:10px;
min-width:140px;
text-align:center;
}
.dead{
opacity:0.4;
text-decoration:line-through;
}

#players{
display:flex;
flex-wrap:wrap;
justify-content:center;
}
</style>
</head>
<body>

<div id="start" class="screen active">
<h1 class="title">RUSSIAN ROULETTE</h1>
<input id="nameInput" placeholder="DEIN NAME">
<button id="goMenu">ENTER</button>
</div>

<div id="menu" class="screen">
<h1 class="title">NIGHT CITY</h1>
<button id="createLobby">CREATE LOBBY</button>
<button id="joinLobby">JOIN LOBBY</button>
</div>

<div id="lobby" class="screen">
<h1 class="title">LOBBY</h1>
<div id="lobbyCode" style="font-size:2rem;margin:20px"></div>
<div id="players"></div>
<button id="addKI">+ KI</button>
<button id="startGame">START</button>
<button id="shootBtn">SHOOT</button>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyBa5w0hQ1v7Nowk-BvDgkGeNRNf1WJtDgw",
authDomain:"rrweb-dc73f.firebaseapp.com",
databaseURL:"https://rrweb-dc73f-default-rtdb.europe-west1.firebasedatabase.app",
projectId:"rrweb-dc73f"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const auth=firebase.auth();

let user,playerName,lobbyCode,myKey;
let gameRef,players=[],gameState;

auth.signInAnonymously();
auth.onAuthStateChanged(u=>user=u);

function show(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

document.getElementById("goMenu").onclick=()=>{
playerName=document.getElementById("nameInput").value||"Player";
show("menu");
};

document.getElementById("createLobby").onclick=()=>{
lobbyCode=Math.random().toString(36).slice(2,6).toUpperCase();
enterLobby();
};

document.getElementById("joinLobby").onclick=()=>{
lobbyCode=prompt("LOBBY CODE?");
if(lobbyCode) enterLobby();
};

function enterLobby(){
show("lobby");
document.getElementById("lobbyCode").innerText="CODE: "+lobbyCode;
gameRef=db.ref("lobbies/"+lobbyCode);

const playersRef=gameRef.child("players");
const newRef=playersRef.push();
myKey=newRef.key;

newRef.set({
name:playerName,
uid:user.uid,
alive:true,
isKI:false
});

newRef.onDisconnect().remove();

gameRef.on("value",snap=>{
const data=snap.val();
if(!data)return;

players=Object.entries(data.players||{})
.map(([k,v])=>({key:k,...v}));

gameState=data.gameState;
updateUI();
});
}

function updateUI(){
document.getElementById("players").innerHTML=
players.map(p=>{
return `<div class="player-card ${p.alive?'':'dead'}">
${p.name}${p.isKI?' ðŸ¤–':''}
</div>`;
}).join("");

if(!gameState)return;

const current=players[gameState.turn];
if(current?.isKI && current.alive){
setTimeout(()=>doShoot(),1500);
}
}

document.getElementById("addKI").onclick=()=>{
gameRef.child("players").push({
name:"KI-"+Math.floor(Math.random()*100),
uid:"ki"+Date.now(),
alive:true,
isKI:true
});
};

document.getElementById("startGame").onclick=()=>{
gameRef.child("gameState").set({
turn:0,
chambers:6,
bullet:Math.floor(Math.random()*6),
pos:0
});
};

document.getElementById("shootBtn").onclick=()=>{
if(!gameState)return;
const current=players[gameState.turn];
if(current.uid!==user.uid)return;
doShoot();
};

function doShoot(){
let pos=gameState.pos+1;

if(pos-1===gameState.bullet){
const deadKey=players[gameState.turn].key;
gameRef.child("players/"+deadKey).update({alive:false});
}

gameRef.child("gameState/pos").set(pos%6);

gameRef.child("gameState/turn")
.transaction(t=>{
let next=(t+1)%players.length;
while(!players[next].alive){
next=(next+1)%players.length;
}
return next;
});
}
</script>
</body>
</html>
